{% load static %}
<!doctype html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    
    <title>{% block title %}Art Marketplace{% endblock %}</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ¨</text></svg>">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{% static 'css/theme.css' %}">


    <style>
      :root {
        --accent: #8B5CF6; 
        --accent-hover: #7C3AED;
      }

      body {
        font-family: 'Inter', sans-serif;
        
        background: linear-gradient(-45deg, #050505, #1a0b2e, #0f172a, #000000);
        background-size: 400% 400%; 
        
        animation: gradientBG 15s ease infinite;
        
        min-height: 100vh;
        overflow-y: scroll !important; 
      }

      @keyframes gradientBG {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }

      h1, h2, h3, h4, .navbar-brand {
        font-family: 'Playfair Display', serif;
        letter-spacing: 0.5px;
      }

      .navbar {
        background: rgba(18, 18, 18, 0.85) !important; 
        backdrop-filter: blur(12px); 
        -webkit-backdrop-filter: blur(12px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        position: sticky;
        top: 0;
        z-index: 1000;
        transition: all 0.3s ease;
      }

      .card {
        background-color: #1E1E1E;
        border: 1px solid #333;
        border-radius: 12px;
        transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
      }

      .card:hover {
        transform: translateY(-5px); 
        box-shadow: 0 10px 25px rgba(139, 92, 246, 0.15); 
        border-color: var(--accent);
      }

      .card-img-top {
          width: 100%;
          height: 250px;
          object-fit: cover;
          object-position: center;
          border-bottom: 1px solid #333;
      }

     
      .btn-accent {
        background-color: var(--accent);
        color: white;
        border: none;
        padding: 8px 20px;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.2s;
      }
      .btn-accent:hover {
        background-color: var(--accent-hover);
        color: white;
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
      }

      main {
        animation: fadeUp 0.8s cubic-bezier(0.16, 1, 0.3, 1);
      }

      @keyframes fadeUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }

      html { scrollbar-gutter: stable; }
      
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #121212; }
      ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

      .badge.bg-secondary-subtle {
        background-color: rgba(139, 92, 246, 0.15) !important;
        color: #A78BFA !important;
        border: 1px solid rgba(139, 92, 246, 0.3);
      }
    </style>

    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        document.body.addEventListener('htmx:configRequest', (event) => {
          event.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';
        });
      });
    </script>

    {% block head %}{% endblock %}
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container">
        <a class="navbar-brand fw-bold fs-3" href="/">Art<span style="color:var(--accent)">Market</span></a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav"
                aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">â˜°</button>

        <div class="collapse navbar-collapse" id="nav">
          <form class="ms-auto d-flex" role="search" method="get" action="/">
            <input class="form-control me-2 bg-dark text-white border-secondary" name="q" type="search" placeholder="Search artworks..."
                   value="{{ q|default:'' }}" style="min-width: 250px;">
            <button class="btn btn-outline-light" type="submit">Search</button>
          </form>

          {% if not request.user.is_authenticated %}
            <a class="btn btn-outline-light ms-3" href="{% url 'login' %}">Login</a>
            <a class="btn btn-accent ms-2" href="{% url 'signup' %}">Sign up</a>
          {% endif %}

          {% if request.user.is_authenticated %}
            
            <a class="btn btn-outline-light ms-3" href="{% url 'web_my_orders' %}">Orders</a>
            <a class="btn btn-outline-light ms-2" href="{% url 'web_favorites' %}">â™¥ Favorites</a>

            <a class="btn btn-accent ms-2 position-relative" href="/cart/">
              Cart
              {% if cart_count %}
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger border border-dark">
                  {{ cart_count }}
                </span>
              {% endif %}
            </a>

            {% if request.user.artistprofile %}
                <div class="vr mx-3 text-secondary d-none d-lg-block"></div>
                <a class="btn btn-sm btn-outline-light border-0" href="{% url 'web_studio_list' %}">Studio</a>
                <a class="btn btn-sm btn-outline-light border-0" href="{% url 'web_studio_stats' %}">Stats</a>
            {% endif %}

            <div class="d-flex align-items-center ms-3 me-2 text-end">
              
              <div class="d-none d-md-block me-2 lh-1">
                <div class="fw-bold text-white small">{{ request.user.username }}</div>
                <span class="text-secondary fw-bold" style="font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1px;">
                  {% if request.user.artistprofile %}ARTIST{% else %}BUYER{% endif %}
                </span>
              </div>

              <a href="{% url 'edit_profile' %}" class="text-decoration-none" title="Edit Profile">
                <div style="width: 42px; height: 42px; border-radius: 50%; overflow: hidden; border: 2px solid var(--accent); cursor: pointer; transition: transform 0.2s; box-shadow: 0 0 10px rgba(139,92,246,0.3);">
                  {% if request.user.artistprofile.profile_image %}
                    <img src="{{ request.user.artistprofile.profile_image.url }}" 
                         alt="Avatar" style="width: 100%; height: 100%; object-fit: cover;">
                  {% else %}
                    <div class="d-flex justify-content-center align-items-center h-100 bg-secondary text-white fw-bold fs-5">
                      {{ request.user.username|slice:":1"|upper }}
                    </div>
                  {% endif %}
                </div>
              </a>
            </div>

            <form method="post" action="{% url 'logout' %}" class="ms-2 d-flex align-items-center">
              {% csrf_token %}
              <button type="submit" class="btn btn-link text-secondary text-decoration-none p-0" title="Log out">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z"/>
                  <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
                </svg>
              </button>
            </form>

          {% endif %}
        </div>
      </div>
    </nav>

    <main class="container py-5" style="min-height: 80vh;">
      {% block content %}{% endblock %}
    </main>

    <footer class="py-5 border-top border-secondary mt-auto" style="background-color: #0d0d0d;">
      <div class="container text-center text-secondary">
        <p class="mb-1 fw-bold text-white">Art<span style="color:var(--accent)">Market</span></p>
        <small>Â© {% now "Y" %} Independent digital art marketplace. All rights reserved.</small>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    {% if messages %}
      <div class="toast-container position-fixed bottom-0 end-0 p-3">
        {% for message in messages %}
          <div class="toast align-items-center text-bg-{{ message.tags }} border-0 show" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
              <div class="toast-body">{{ message }}</div>
              <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
          </div>
        {% endfor %}
      </div>
      <script>
        document.querySelectorAll('.toast').forEach((el) => {
          const t = new bootstrap.Toast(el, { delay: 3000 });
          t.show();
        });
      </script>
    {% endif %}

    {% block scripts %}{% endblock %}
  </body>
</html>